{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://pipeline.com/schemas/credentials.json",
  "title": "Credential Schemas",
  "description": "Expected structure of credentials stored in Vault (for documentation only - NOT stored in JSON configs)",

  "definitions": {
    "jdbcCredentials": {
      "type": "object",
      "description": "JDBC credentials for PostgreSQL and MySQL",
      "required": ["host", "port", "database", "username", "password"],
      "properties": {
        "host": {
          "type": "string",
          "description": "Database host or IP address",
          "examples": ["localhost", "postgres.example.com", "10.0.1.50"]
        },
        "port": {
          "type": "integer",
          "description": "Database port",
          "examples": [5432, 3306]
        },
        "database": {
          "type": "string",
          "description": "Database name"
        },
        "username": {
          "type": "string",
          "description": "Database username"
        },
        "password": {
          "type": "string",
          "description": "Database password (SENSITIVE - Vault only)"
        }
      }
    },

    "iamCredentials": {
      "type": "object",
      "description": "AWS IAM credentials for S3 access",
      "required": ["accessKey", "secretKey", "region"],
      "properties": {
        "accessKey": {
          "type": "string",
          "description": "AWS access key ID (SENSITIVE - Vault only)"
        },
        "secretKey": {
          "type": "string",
          "description": "AWS secret access key (SENSITIVE - Vault only)"
        },
        "region": {
          "type": "string",
          "description": "AWS region",
          "examples": ["us-east-1", "eu-west-1", "ap-southeast-2"]
        },
        "sessionToken": {
          "type": "string",
          "description": "AWS session token for temporary credentials (optional)"
        }
      }
    },

    "kafkaCredentials": {
      "type": "object",
      "description": "Kafka connection credentials",
      "required": ["bootstrapServers"],
      "properties": {
        "bootstrapServers": {
          "type": "string",
          "description": "Comma-separated list of Kafka brokers",
          "examples": ["localhost:9092", "kafka1:9092,kafka2:9092,kafka3:9092"]
        },
        "securityProtocol": {
          "type": "string",
          "enum": ["PLAINTEXT", "SSL", "SASL_PLAINTEXT", "SASL_SSL"],
          "default": "PLAINTEXT"
        },
        "saslMechanism": {
          "type": "string",
          "enum": ["PLAIN", "SCRAM-SHA-256", "SCRAM-SHA-512"],
          "description": "SASL mechanism if using SASL authentication"
        },
        "saslJaasConfig": {
          "type": "string",
          "description": "JAAS configuration string (SENSITIVE - Vault only)"
        },
        "sslTruststoreLocation": {
          "type": "string",
          "description": "Path to SSL truststore"
        },
        "sslTruststorePassword": {
          "type": "string",
          "description": "SSL truststore password (SENSITIVE - Vault only)"
        },
        "sslKeystoreLocation": {
          "type": "string",
          "description": "Path to SSL keystore"
        },
        "sslKeystorePassword": {
          "type": "string",
          "description": "SSL keystore password (SENSITIVE - Vault only)"
        }
      }
    },

    "deltaLakeCredentials": {
      "type": "object",
      "description": "DeltaLake credentials (if using cloud storage)",
      "properties": {
        "storageType": {
          "type": "string",
          "enum": ["local", "s3", "azure", "gcs"],
          "default": "local"
        },
        "s3Credentials": {
          "$ref": "#/definitions/iamCredentials",
          "description": "If storageType is s3"
        },
        "azureCredentials": {
          "type": "object",
          "description": "If storageType is azure",
          "properties": {
            "storageAccountName": { "type": "string" },
            "storageAccountKey": { "type": "string" }
          }
        },
        "gcsCredentials": {
          "type": "object",
          "description": "If storageType is gcs",
          "properties": {
            "projectId": { "type": "string" },
            "keyFilePath": { "type": "string" }
          }
        }
      }
    }
  },

  "oneOf": [
    { "$ref": "#/definitions/jdbcCredentials" },
    { "$ref": "#/definitions/iamCredentials" },
    { "$ref": "#/definitions/kafkaCredentials" },
    { "$ref": "#/definitions/deltaLakeCredentials" }
  ],

  "examples": [
    {
      "$comment": "JDBC credentials example (PostgreSQL)",
      "host": "postgres.example.com",
      "port": 5432,
      "database": "production_db",
      "username": "etl_user",
      "password": "STORED_IN_VAULT_ONLY"
    },
    {
      "$comment": "IAM credentials example (S3)",
      "accessKey": "STORED_IN_VAULT_ONLY",
      "secretKey": "STORED_IN_VAULT_ONLY",
      "region": "us-west-2"
    },
    {
      "$comment": "Kafka credentials example (SASL)",
      "bootstrapServers": "kafka1:9092,kafka2:9092,kafka3:9092",
      "securityProtocol": "SASL_SSL",
      "saslMechanism": "SCRAM-SHA-256",
      "saslJaasConfig": "STORED_IN_VAULT_ONLY"
    }
  ]
}
